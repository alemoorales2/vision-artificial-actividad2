\documentclass[12pt]{article}

% Codificación y fuentes
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Idioma
\usepackage[spanish]{babel}

% Matemáticas
\usepackage{amsmath, amssymb, amsthm}
\usepackage[mathscr]{euscript}
\usepackage[makeroom]{cancel}

% Tablas y gráficos
\usepackage{graphicx}
\usepackage{array}
\usepackage{booktabs}
\usepackage{colortbl}
\usepackage{xcolor}
\definecolor{azul}{rgb}{0.17,0.40,0.69}

% Formato de página
\usepackage[a4paper]{geometry}
\geometry{top=2.5cm, bottom=2.5cm, left=3cm, right=3cm}
\setlength{\headheight}{14.5pt}
\addtolength{\topmargin}{-2.5pt}
\usepackage{setspace}
\onehalfspacing

% Cabeceras y pies
\usepackage{fancyhdr}
\pagestyle{fancy}
\rhead[\leftmark]{\thepage}
\chead[]{}
\lhead[\thepage]{\rightmark}
\cfoot{}

% Otros
\usepackage{enumerate}
\usepackage[hypertexnames=false]{hyperref}
\usepackage{natbib}

\addto\captionsspanish{\renewcommand{\tablename}{Tabla}}

\title{Exploración de Filtros Espaciales y Morfológicos en Escenarios Reales}
\author{Miguel Fernández Llamas}
\date{\today}

\begin{document}

\include{portada}

\tableofcontents
\clearpage

% ============================================================
% PEGAR DESDE AQUÍ (contenido principal de la memoria)
% ============================================================

\section{Resumen}
Este trabajo analiza el efecto de filtros espaciales y operaciones morfológicas sobre nueve imágenes reales procedentes de tres dominios: radiografías de tórax (Open-I), inspección industrial (MVTec AD) y escenas satelitales (EuroSAT). Se evaluaron filtros de suavizado (Gaussiano, mediana), realce (unsharp masking) y detectores de borde (Sobel, Laplace, Canny), junto con operaciones morfológicas clásicas (erosión, dilatación, apertura, cierre, top-hat). La comparación cuantitativa empleó métricas de preservación estructural (SSIM), estimación robusta de ruido ($\hat{\sigma}$), contraste RMS y densidad de bordes. Los resultados muestran que el filtro Gaussiano con $\sigma$ bajo ofrece el mejor equilibrio entre reducción de ruido y preservación estructural en radiografías, la mediana destaca en texturas industriales repetitivas, y el unsharp masking es eficaz para resaltar defectos finos aunque amplifica ruido. En morfología, la apertura reduce fragmentación en fondos dominantes y el cierre conecta estructuras discontinuas en escenas satelitales.

\section{Introducción}
El procesamiento digital de imágenes emplea operadores locales para modificar intensidades y organización espacial. Los \textit{filtros espaciales} atenúan ruido, suavizan texturas o realzan bordes mediante convolución \citep{gonzalez2008digital}, mientras que las \textit{operaciones morfológicas} modifican regiones según su forma usando elementos estructurantes \citep{serra1982image}. La correcta selección de estos operadores resulta fundamental para tareas posteriores como segmentación, clasificación o detección de anomalías.

La elección del operador depende del dominio de aplicación: en radiografías médicas es crítico preservar contornos anatómicos sin perder información diagnóstica relevante; en inspección industrial interesa resaltar defectos sobre patrones repetitivos manteniendo bajo el ruido de fondo; en teledetección la selección varía según el tipo de escena (urbana, fluvial, forestal) y el objetivo final.

Este trabajo propone una comparación experimental multitemática sobre datasets de referencia: (i) aplicar filtros espaciales y morfológicos representativos; (ii) cuantificar su impacto con métricas objetivas de similitud estructural (SSIM) \citep{wang2004ssim}, ruido residual y contraste; (iii) analizar ventajas y limitaciones específicas por dominio; y (iv) evaluar pipelines que combinan múltiples operadores en secuencia.

\section{Material y Métodos}

\subsection{Conjunto de imágenes}
Se seleccionó un conjunto multitemático de nueve imágenes (Tabla \ref{tab:dataset}) procedentes de repositorios públicos de referencia, cubriendo tres dominios complementarios:
\begin{itemize}
\item \textbf{Médico}: radiografías de tórax del repositorio Open-I (Indiana University Chest X-Ray Collection) \citep{demner2005openi}, con variabilidad en densidad de tejidos y estructuras anatómicas.
\item \textbf{Industrial}: imágenes de defectos superficiales del dataset MVTec Anomaly Detection \citep{bergmann2019mvtec}, incluyendo patrones de rejilla, cuero y tuercas metálicas con defectos etiquetados.
\item \textbf{Satelital}: escenas del dataset EuroSAT \citep{helber2019eurosat}, cubriendo clases de uso del suelo (residencial, fluvial, forestal).
\end{itemize}
Las imágenes se procesaron en escala de grises con normalización de intensidades al rango $[0,1]$, manteniendo su contenido original para preservar la comparabilidad intra-imagen.

% --- TABLA DATASET ---
\begin{table}[ht]
\centering
\caption{Conjunto de imágenes seleccionadas según fuentes de la rúbrica.}
\label{tab:dataset}
\begin{tabular}{llll}
\toprule
ID & Dominio & Fuente & Descripción \\
\midrule
I01 & Médica & Open-I (Indiana CXR) & Radiografía tórax \\
I02 & Médica & Open-I (Indiana CXR) & Radiografía tórax \\
I03 & Médica & Open-I (Indiana CXR) & Radiografía tórax \\
I04 & Industrial & MVTec AD & Grid (defecto: glue) \\
I05 & Industrial & MVTec AD & Leather (defecto: glue) \\
I06 & Industrial & MVTec AD & Metal nut (defecto: color) \\
I07 & Satélite & EuroSAT/alternativa & Residential \\
I08 & Satélite & EuroSAT/alternativa & River \\
I09 & Satélite & EuroSAT/alternativa & Forest \\
\bottomrule
\end{tabular}
\end{table}

% --- FIGURA: Grid de imágenes originales ---
\begin{figure}[ht]
\centering
\includegraphics[width=0.85\linewidth]{figures/originals_grid.png}
\caption{Conjunto de imágenes originales (I01--I09): médicas (fila 1), industriales (fila 2), texturas/satélite (fila 3).}
\label{fig:originals}
\end{figure}

\subsection{Filtros espaciales evaluados}
Se consideraron tres familias principales:
\begin{enumerate}[i)]
\item \textbf{Suavizado lineal (Gaussiano)}: reduce ruido de alta frecuencia mediante convolución con un núcleo Gaussiano. Se evaluaron dos escalas (p.\,ej., $\sigma=1$ y $\sigma=2$) para observar el compromiso entre reducción de ruido y pérdida de detalle.
\item \textbf{Suavizado no lineal (Mediana)}: elimina impulsos y ruido local preservando bordes mejor que el suavizado lineal en muchos casos. Se evaluaron radios de vecindario representativos (p.\,ej., $r=2$ y $r=4$).
\item \textbf{Realce (Unsharp masking)}: incrementa el contraste local sumando una componente de alta frecuencia (imagen menos suavizado). Se ensayó una configuración moderada (p.\,ej., $r=1$, $\alpha=1$) para evitar sobre-realce.
\end{enumerate}
Como referencia de \textit{realce de bordes}, se incluyeron los operadores Sobel, Laplaciano y el detector de Canny \citep{canny1986computational}, útiles para visualizar discontinuidades de intensidad. Aunque no son adecuados como imagen final (producen mapas binarios de bordes y amplifican ruido), permiten evaluar la preservación de contornos tras aplicar otros filtros.

\subsection{Operaciones morfológicas y pipelines}
Las operaciones morfológicas se aplicaron sobre la imagen (en escala de grises) usando un elemento estructurante disco y radios representativos ($r=2$ y $r=4$): \textbf{erosión}, \textbf{dilatación}, \textbf{apertura} (erosión seguida de dilatación) y \textbf{cierre} (dilatación seguida de erosión). Adicionalmente, se exploraron transformaciones \textbf{top-hat} y \textbf{black-hat} para resaltar detalles brillantes u oscuros.

Para estudiar la \textit{secuenciación} de operadores se definieron tres pipelines:
\begin{itemize}
\item \textbf{P1}: mediana (ventana $3\times 3$) seguida de unsharp (realce moderado).
\item \textbf{P2}: cierre (radio 3) seguido de apertura (radio 3), orientado a conectar regiones y eliminar pequeñas discontinuidades.
\item \textbf{P3}: Gaussiano ($\sigma=1$) seguido de top-hat (radio 3), para resaltar detalles pequeños tras un suavizado previo.
\end{itemize}

\subsection{Métricas de evaluación}
Se emplearon métricas cuantitativas diferenciadas según el tipo de operación:

\textbf{Para filtros espaciales:}
\begin{itemize}
\item \textbf{SSIM} (Structural Similarity Index) \citep{wang2004ssim}: mide la preservación estructural respecto a la imagen original, considerando luminancia, contraste y estructura. Valores cercanos a 1 indican alta similitud.
\item \textbf{$\hat{\sigma}$}: estimación robusta del ruido residual mediante MAD (Median Absolute Deviation) sobre la componente de alta frecuencia. Valores bajos indican menor ruido.
\item \textbf{Contraste RMS}: desviación estándar de las intensidades, capturando el rango dinámico efectivo.
\item \textbf{Densidad de bordes}: proporción de píxeles detectados como borde por Canny, indicando preservación de discontinuidades.
\end{itemize}
El criterio combinado prioriza SSIM alto con $\hat{\sigma}$ bajo.

\textbf{Para morfología:} tras binarización con umbral de \textbf{Otsu} \citep{otsu1979threshold}, se miden el número de componentes conexas ($N_\mathrm{comp}$) y la conservación de área. El \textbf{ScoreMorph} favorece menor fragmentación manteniendo el área total.

\section{Resultados}

\subsection{Top-3 filtros/pipelines por imagen}
La Tabla \ref{tab:topfilters} resume los tres mejores filtros por imagen según el criterio combinado (SSIM alto y $\hat{\sigma}$ bajo). De forma global, el suavizado Gaussiano y la mediana dominan en radiografías (I01--I03) y en la escena satelital de río (I08), mientras que el realce unsharp destaca en defectos industriales finos (I05) y texturas (I09), aunque con incremento de $\hat{\sigma}$ en varios casos.

% --- TABLA TOPFILTERS RESUMIDA ---
\begin{table}[ht]
\centering
\caption{Mejor filtro por imagen según criterio combinado (SSIM alto, $\hat{\sigma}$ bajo).}
\label{tab:topfilters}
\begin{tabular}{llllcc}
\toprule
ID & Dominio & Mejor filtro & SSIM & $\hat{\sigma}$ & Contraste \\
\midrule
I01 & Médica & gaussian\_s1 & 0.963 & 0.004 & 0.195 \\
I02 & Médica & gaussian\_s2 & 0.873 & 0.002 & 0.248 \\
I03 & Médica & gaussian\_s1 & 0.939 & 0.006 & 0.239 \\
I04 & Industrial & median\_r2 & 0.977 & 0.016 & 0.184 \\
I05 & Industrial & unsharp\_r1\_a1 & 0.960 & 0.031 & 0.090 \\
I06 & Industrial & gaussian\_s2 & 0.942 & 0.000 & 0.407 \\
I07 & Satélite & unsharp\_r1\_a1 & 0.970 & 0.064 & 0.133 \\
I08 & Satélite & gaussian\_s1 & 0.824 & 0.008 & 0.107 \\
I09 & Satélite & unsharp\_r1\_a1 & 0.979 & 0.043 & 0.067 \\
\bottomrule
\end{tabular}
\end{table}

\paragraph{Radiografías (I01--I03).}
El Gaussiano con $\sigma$ bajo domina, ofreciendo SSIM elevado y reducción de $\hat{\sigma}$, consistente con la necesidad de atenuar grano sin degradar estructuras de baja frecuencia. La mediana preserva más microestructura pero con menor supresión de ruido.

\paragraph{Industrial (I04--I06).}
La mediana ($r=2$) ofrece SSIM muy alto en patrones (I04). En defectos finos (I05, tipo \textit{fold}), unsharp incrementa la prominencia del defecto a costa de mayor $\hat{\sigma}$. En fondos dominantes (I06), el Gaussiano elimina ruido residual sin alterar la estructura global.

\paragraph{Satelital (I07--I09).}
En escenas urbanas (I07), unsharp intensifica la textura pero amplifica ruido. El Gaussiano equilibra suavizado y preservación en ríos (I08). En bosques (I09), unsharp realza textura con incremento moderado de ruido.

\subsection{Cambios en histogramas}
El análisis de histogramas revela patrones consistentes según el tipo de filtro aplicado:
\begin{itemize}
\item El \textbf{filtro Gaussiano} conserva la forma global del histograma con cambios suaves, desplazando ligeramente la distribución hacia valores medios (Figura~\ref{fig:histogramas}).
\item El \textbf{unsharp masking} redistribuye intensidades expandiendo el rango dinámico, lo que se manifiesta en colas más pronunciadas y posibles picos secundarios.
\end{itemize}
En escenas con fondo dominante (radiografías, imágenes industriales) aparecen picos pronunciados que el suavizado preserva, mientras el realce puede fragmentarlos. En imágenes satelitales con distribuciones más uniformes, ambos filtros producen cambios más graduales.

\subsection{Operaciones morfológicas destacadas}
La Tabla~\ref{tab:morph} muestra las operaciones mejor puntuadas. La \textbf{apertura} (opening\_r4) domina en radiografías e imágenes industriales con fondo uniforme, reduciendo regiones espurias. El \textbf{cierre} conecta estructuras en escenas satelitales (ríos, caminos). La \textbf{dilatación} destaca en defectos industriales para aumentar su visibilidad.

% --- TABLA MORPH RESUMIDA ---
\begin{table}[ht]
\centering
\caption{Mejor operación morfológica por dominio (menor fragmentación con conservación de área).}
\label{tab:morph}
\begin{tabular}{lllccc}
\toprule
Dominio & ID & Operación & $N_\mathrm{comp}$ & Área & SSIM \\
\midrule
Médica & I01 & opening\_r4 & 4 & 120663 & 0.877 \\
Médica & I02 & opening\_r4 & 7 & 117097 & 0.851 \\
Industrial & I06 & opening\_r4 & 1 & 100368 & 0.908 \\
Industrial & I05 & dilation\_r2 & 516 & 80774 & 0.603 \\
Satélite & I08 & closing\_r2 & 12 & 706 & 0.881 \\
Satélite & I07 & closing\_r2 & 36 & 1171 & 0.758 \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Observaciones cualitativas}
Las Figuras~\ref{fig:comp_I01}--\ref{fig:comp_I07} muestran patrones recurrentes: \textbf{Sobel/Laplace/Canny} resaltan bordes pero amplifican ruido; \textbf{Gaussiano} reduce grano pero atenúa microdetalles; \textbf{Mediana} preserva mejor las discontinuidades; \textbf{Unsharp} destaca defectos finos pero introduce halos en zonas uniformes. En \textbf{morfología}, radios grandes simplifican pero pueden deformar contornos; el cierre conecta regiones pero puede rellenar huecos no deseados.

% ============================================================
% FIGURAS: Comparativas visuales por dominio
% ============================================================
\begin{figure}[ht]
\centering
\includegraphics[width=\linewidth]{figures/I01_montage.png}
\caption{Comparativa visual en radiografía (I01): original y efectos de filtros espaciales/morfológicos.}
\label{fig:comp_I01}
\end{figure}

\begin{figure}[ht]
\centering
\includegraphics[width=\linewidth]{figures/I04_montage.png}
\caption{Comparativa visual en imagen industrial (I04): original, filtros espaciales y operaciones morfológicas.}
\label{fig:comp_I04}
\end{figure}

\begin{figure}[ht]
\centering
\includegraphics[width=\linewidth]{figures/I07_montage.png}
\caption{Comparativa visual en escena satelital urbana (I07): efectos de suavizado y realce.}
\label{fig:comp_I07}
\end{figure}

\begin{figure}[ht]
\centering
\begin{minipage}{0.48\textwidth}
\centering
\includegraphics[width=\linewidth]{figures/I01_hist.png}
\end{minipage}
\hfill
\begin{minipage}{0.48\textwidth}
\centering
\includegraphics[width=\linewidth]{figures/I04_hist.png}
\end{minipage}

\vspace{0.3cm}

\begin{minipage}{0.48\textwidth}
\centering
\includegraphics[width=\linewidth]{figures/I07_hist.png}
\end{minipage}
\caption{Histogramas normalizados por dominio: (arriba-izq.) I01 radiografía con distribución bimodal; (arriba-der.) I04 industrial con pico dominante; (abajo) I07 satélite con distribución más uniforme. El Gaussiano conserva la forma global mientras unsharp expande el rango dinámico.}
\label{fig:histogramas}
\end{figure}

\section{Conclusiones}
El estudio experimental confirma que la eficacia de filtros espaciales y morfológicos depende críticamente del dominio de aplicación y la escala de las estructuras de interés:

\begin{itemize}
\item \textbf{Suavizado Gaussiano} con $\sigma$ bajo (1--2 píxeles) ofrece el mejor compromiso entre reducción de ruido y preservación estructural en radiografías y escenas satelitales, alcanzando SSIM $>0.90$ en la mayoría de casos.
\item \textbf{Filtro Mediana} preserva mejor los bordes en texturas industriales con patrones repetitivos, evitando el emborronamiento característico del suavizado lineal y siendo especialmente efectivo contra ruido impulsivo.
\item \textbf{Unsharp masking} resulta eficaz para resaltar defectos finos y aumentar el contraste local, aunque con el riesgo inherente de amplificar ruido residual y generar artefactos de halo en transiciones abruptas.
\item En \textbf{operaciones morfológicas}, la apertura reduce fragmentación en imágenes con fondos dominantes (SSIM $>0.85$); el cierre conecta estructuras discontinuas como ríos y caminos en escenas satelitales.
\end{itemize}

\textbf{Líneas futuras de investigación:}
\begin{enumerate}
\item Selección adaptativa multiescala basada en contenido local de la imagen.
\item Optimización de parámetros orientada a tarea específica (clasificación, segmentación semántica).
\item Combinación con técnicas de aprendizaje profundo para realce guiado por características aprendidas.
\item Evaluación en datasets más extensos con ground truth para métricas de rendimiento en tareas downstream.
\end{enumerate}





% ============================================================
% FIN DEL CONTENIDO PRINCIPAL
% ============================================================

\clearpage

\bibliographystyle{apalike}
\bibliography{referencias}

\newpage
\appendix

\section{Declaración de uso de IA generativa}
Para la redacción y mejora de estilo de esta memoria se utilizó apoyo de una herramienta de IA generativa (ChatGPT, OpenAI) como asistente lingüístico (reescritura, estructuración y clarificación de texto). Las decisiones metodológicas, el diseño experimental, el cálculo de métricas y la interpretación de resultados fueron realizados y verificados por el equipo, revisando críticamente todas las salidas propuestas por la IA y corrigiendo posibles imprecisiones. No se empleó la IA para inventar datos, alterar resultados ni sustituir el análisis experimental.

\end{document}
